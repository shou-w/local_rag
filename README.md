# 環境構築とDB作成手順 (ファイル削除対応版)

このドキュメントでは、環境構築とDB作成の手順について説明します。以前のバージョンからファイルを削除したため、内容を更新しました。

## 環境の同期

以下のコマンドを実行して、プロジェクトに必要な環境を同期してください。

```bash
uv sync
```

このコマンドは、`pyproject.toml` ファイルに記述された依存関係をインストールし、プロジェクトで使用するPython環境を整えます。

## DB作成方法

DBを作成するには、以下の手順に従ってください。

1.  `db` ディレクトリ内に、必要な条件を満たすDBが存在するか確認してください。DB名、データセット、チャンクサイズなどの条件が一致するものがあるかを確認します。
2.  必要なDBがない場合は、以下のコマンドを実行してDBを作成します。

```bash
uv run src/db_management/create_db.py
```

上記のコマンドを実行すると、`src/db_management/create_db.py` スクリプトが実行され、ChromaDBが作成されます。このスクリプトは、指定されたPDFファイルからテキストを抽出し、OpenAI APIを使用してベクトル埋め込みを生成し、ChromaDBに保存します。

## スクリプトの詳細 (`src/db_management/create_db.py`)

`src/db_management/create_db.py` は、PDFファイルからテキストを抽出し、ChromaDBにベクトル埋め込みを保存するPythonスクリプトです。スクリプトの実行には、以下の環境変数が必要です。

- `OPENAI_API_KEY`: OpenAI APIキー

スクリプトの動作をカスタマイズするために、以下のパラメータを設定できます。これらのパラメータは、スクリプト内で直接設定するか、環境変数として渡すことができます。

- `PDF_PATH`: PDFファイルのパス (デフォルト: `data/京都市基本計画.pdf`)
- `CHUNK_SIZE`: テキストを分割するチャンクのサイズ (デフォルト: 1000)
- `CHUNK_OVERLAP`: チャンク間のオーバーラップサイズ (デフォルト: 200)
- `EMBEDDING_MODEL`: 使用する埋め込みモデル (デフォルト: `text-embedding-ada-002`)
- `DB_PATH`: ChromaDBの保存先パス (デフォルト: `db/chunking_evaluation-pdf_kyoto_1000_all_character`)

詳細なパラメータ設定については、`src/db_management/create_db.py` のコードを参照してください。

## DBリセット方法 (`reset_db.py`)

DBをリセット（初期化）するには、以下のコマンドを実行します。

```bash
uv run src/db_management/reset_db.py
```

このスクリプトは、既存のDBを削除し、新しい空のDBを作成します。DBの内容を完全に消去したい場合に実行してください。

## DB削除方法 (`delete_db.py`)

DBを完全に削除するには、以下のコマンドを実行します。

```bash
uv run src/db_management/delete_db.py
```

このスクリプトは、DBファイルと関連するメタデータを完全に削除します。DBが不要になった場合に実行してください。

## 注意事項 (重要)

- **`.env` ファイルの設定:** DB作成前に、必ず `.env` ファイルに `OPENAI_API_KEY` が設定されていることを確認してください。`.env` ファイルに `OPENAI_API_KEY=YOUR_API_KEY` のように記述します。APIキーが設定されていない場合、スクリプトは正常に動作しません。
- **`uv sync` の実行:** `uv sync` コマンドは、プロジェクトの依存関係を更新するために使用します。環境変更後、または新しいライブラリをインストールした後は必ず実行してください。
- **ライブラリのインストール確認:** `uv run src/db_management/create_db.py` を実行する前に、必ず `uv sync` を実行して、必要なライブラリがインストールされていることを確認してください。必要なライブラリがインストールされていない場合、スクリプトはエラーを発生させます。
- **DBの条件確認:** DBを作成する前に、`db` ディレクトリ内に必要な条件のDBがないか確認してください。DB名、データセット、チャンクサイズなどの条件が一致するものがあるかを確認します。
